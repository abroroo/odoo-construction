<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Batch Task Creation Wizard Form -->
    <record id="view_batch_task_wizard_form" model="ir.ui.view">
        <field name="name">construction.batch.task.wizard.form</field>
        <field name="model">construction.batch.task.wizard</field>
        <field name="arch" type="xml">
            <form string="Batch Create Tasks">
                <header>
                    <!-- Step indicators -->
                    <div class="o_form_statusbar">
                        <button name="action_parse_and_preview"
                                string="Parse &amp; Preview"
                                type="object"
                                class="btn-primary"
                                invisible="step != 'input'"/>

                        <button name="action_create_tasks"
                                string="Create Tasks"
                                type="object"
                                class="btn-primary"
                                invisible="step != 'preview'"/>

                        <button name="action_previous_step"
                                string="‚Üê Previous"
                                type="object"
                                class="btn-secondary"
                                invisible="step == 'input'"/>

                        <button name="action_view_created_tasks"
                                string="View Tasks"
                                type="object"
                                class="btn-primary"
                                invisible="step != 'result'"/>
                    </div>
                </header>

                <sheet>
                    <!-- Step 1: Input -->
                    <div invisible="step != 'input'">
                        <div class="oe_title">
                            <h1>Batch Create Tasks</h1>
                            <p>Simple copy-paste interface for bulk task creation</p>
                        </div>

                        <group>
                            <group>
                                <field name="project_id" required="1"/>
                                <field name="create_budget_lines"/>
                                <field name="default_stage_id" invisible="not project_id"/>
                            </group>
                        </group>

                        <group string="Task Data Format">
                            <div class="alert alert-info">
                                <h5>üìã Copy-Paste Format Instructions:</h5>
                                <p><strong>Format:</strong> Number|Task Name|Unit|Quantity</p>
                                <p><strong>Separator:</strong> Use the pipe character "|" between fields</p>
                                <p><strong>Hierarchy:</strong> Use decimals for sub-tasks (1, 1.1, 1.2, 2, 2.1, etc.)</p>
                                <p><strong>Example:</strong></p>
                                <code>
                                    1|CONCRETE FOUNDATION WORK|M3|25.5<br/>
                                    1.1|EXCAVATION WORK|M3|30.0<br/>
                                    1.2|CONCRETE POURING|M3|25.5<br/>
                                    2|STEEL REINFORCEMENT|KG|1250.0
                                </code>
                            </div>
                        </group>

                        <group string="Paste Your Task Data">
                            <field name="task_data"
                                   widget="text"
                                   nolabel="1"
                                   placeholder="1|CONCRETE FOUNDATION WORK|M3|25.5&#10;1.1|EXCAVATION WORK|M3|30.0&#10;1.2|CONCRETE POURING|M3|25.5&#10;2|STEEL REINFORCEMENT|KG|1250.0&#10;2.1|REBAR CUTTING|KG|1250.0&#10;2.2|REBAR INSTALLATION|KG|1250.0"
                                   options="{'resizable': true}"
                                   style="min-height: 300px; font-family: monospace;"/>
                        </group>
                    </div>

                    <!-- Step 2: Preview -->
                    <div invisible="step != 'preview'">
                        <div class="oe_title">
                            <h1>Preview &amp; Validate</h1>
                            <p>Review parsed tasks before creation</p>
                        </div>

                        <!-- Validation Errors -->
                        <div invisible="not validation_errors" class="alert alert-danger">
                            <h5>‚ö†Ô∏è Validation Errors:</h5>
                            <field name="validation_errors" readonly="1" nolabel="1"/>
                        </div>

                        <!-- Preview Success -->
                        <div invisible="validation_errors" class="alert alert-success">
                            <h5>‚úÖ Validation Successful!</h5>
                            <p>All tasks parsed correctly. Review below and click "Create Tasks" to proceed.</p>
                        </div>

                        <!-- Preview Table -->
                        <field name="preview_lines" nolabel="1">
                            <tree create="false" delete="false" edit="false">
                                <field name="task_number"/>
                                <field name="task_type"/>
                                <field name="task_name"/>
                                <field name="task_unit"/>
                                <field name="task_quantity"/>
                                <field name="parent_number"/>
                            </tree>
                        </field>
                    </div>

                    <!-- Step 3: Result -->
                    <div invisible="step != 'result'">
                        <div class="oe_title">
                            <h1>Creation Complete! üéâ</h1>
                        </div>

                        <div class="alert alert-success">
                            <h5>‚úÖ Tasks Created Successfully!</h5>
                        </div>

                        <group>
                            <group>
                                <field name="created_tasks_count" readonly="1"/>
                                <field name="created_budget_lines_count" readonly="1" invisible="not create_budget_lines"/>
                            </group>
                        </group>

                        <group string="Summary">
                            <field name="result_message" readonly="1" nolabel="1" widget="text"/>
                        </group>

                        <div class="text-center mt-3">
                            <button name="action_view_created_tasks"
                                    string="View Created Tasks"
                                    type="object"
                                    class="btn-primary btn-lg"/>
                        </div>
                    </div>

                    <!-- Hidden fields for step management -->
                    <field name="step" invisible="1"/>
                </sheet>

                <footer>
                    <button string="Cancel" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Preview Line Tree View -->
    <record id="view_batch_task_preview_tree" model="ir.ui.view">
        <field name="name">construction.batch.task.preview.tree</field>
        <field name="model">construction.batch.task.preview</field>
        <field name="arch" type="xml">
            <tree create="false" delete="false" edit="false">
                <field name="task_number"/>
                <field name="task_type"/>
                <field name="task_name"/>
                <field name="task_unit"/>
                <field name="task_quantity"/>
                <field name="parent_number"/>
                <field name="has_errors"/>
            </tree>
        </field>
    </record>

    <!-- Batch Task Creation Action -->
    <record id="action_batch_task_wizard" model="ir.actions.act_window">
        <field name="name">Batch Create Tasks</field>
        <field name="res_model">construction.batch.task.wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
        <field name="context">{}</field>
    </record>

</odoo>